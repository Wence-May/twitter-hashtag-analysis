# 舆情热度的攻与防

梅佳奕 10165300206	吴双10164102141

### 一、应用问题

#### 1.1 探讨方向

​	在具有一定社交规模的内容发布平台（如微博、Twitter）上，常常有不同用户发布内容相似、话题相近的内容，但这些内容在社交传播中最终获得不同的热度。我们发现，影响这样的热度的因素有很多，比如发布者等级、粉丝基础、发布时间、与其他热点话题的关联性等；但如果想要人为主动地影响特定内容的热度，一些客观因素如账号等级、粉丝基础等往往难以改变，那么，何时、如何去给内容赋予热点话题关联性（即打上不同的#tag），就成为了账号运营人员能够把握的最大影响因素。

​    因此，本项目的主要目的在于探讨，在上述客观因素的限制下，通过人为地引导标签来控制舆论事件热度上升/下降的可操作性空间。在此基础上，可以讨论热点话题与标签对于内容的影响是否具有固定的模式。

#### 1.2 预期目标

1. 对于用户想要发布的内容，推荐为其添加/减少某些tag来提高其曝光率；

2. 对于想要控评的内容，避免某些话题倾向，或推荐与某些热议话题/账户发展协作关系，来缩减其生命周期；

3. 提供一定的可视化界面，以可交互的网络图的形式，展示用户对tag选择操作的预判，以及热度随时间的变化；

### 二、数据抓取

​		考虑到国人使用微博平台发布社交内容的使用习惯，即不普遍具有使用hashtag的习惯，本项目选择Twitter平台的内容数据作为数据来源，获取方式为Twitter官方API，以搜索关键词的查询方式进行爬取。在Twitter官方150次访问/15min的限制下，少量多次，得到针对特定事件话题的tweets数据库，总量为3000条。
​	数据项统计：

![image-20210608071104377](舆情热度的攻与防-final.assets/image-20210608071104377-1623107551947.png)

一条完整的推文数据解析后得到如上图结构。其中各个维度的释义为：

- created_at：tweet创建时间
- tweet_id：tweet id
- text：tweet的文本内容
- text_len：推文长度（字符）
- hashtags：标签的列表
- lang：使用语言
- user_mentions：推文标记用户的id列表
- user_id：发布者的id
- user_name：发布者用户名
- user_screen_name：发布者显示的名称
- user_location：发布地点
- user_description：发布者自我简介
- user_friends：发布者好友
- user_follower：发布者的粉丝
- retweet_count：tweet被转发次数
- favorite_count：tweet被点赞次数
- lang：tweet语言
- is_retweet：是否是转发
- rt_created_at：如果是转发的推文，被转发的原始tweet被创建的时间
- rt_tweet_id：被转发的原始tweet的id
- rt_user_id：被转发的原始tweet的发布者id
- rt_user_name：被转发的原始tweet的发布者用户名
- rt_user_screen_name：被转发的原始tweet的发布者所显示的名称
- rt_user_location：被转发的原始tweet的发布地点
- rt_user_description：被转发的原始tweet的发布者的自我介绍
- rt_user_friends：被转发的原始tweet的发布者的好友
- rt_user_follower：被转发的原始tweet的发布者的粉丝
- rt_retweet_count：被转发的原始tweet的被转发次数
- rt_favorite_count：被转发的原始tweet的被点赞次数
- rt_lang：被转发的原始tweet的语言



- 收集到的数据包括但不限于维度：推文内容、话题关键词、用户信息、时间、评论转发点赞收藏（代表热度的特征）；
- 数据集具备一定的时区多样性、用户多样性、语言多样性；

### 三、数据处理

1. 通过keyword关键词查找我们研究的事件，抓取足够的具有hashtag的相关tweet进行遍历，制作数据集；
2. 对整个数据进行类似转置的操作：即将所有数据对hashtag进行分类，从而得到一个数据集，这个数据集的内容是多个tweet组，每一个tweet组都以hashtag为index（一个具有多个hashtag的tweet的热度将被均匀分配给这几个hashtag）；
3. 将每一个tweet组中的tweet的状态记录下来，计算出当时的热度，存入数据库。
4. 对聚类的结果进行可视化。

### 四、热度计算

#### 3.1 公式定义

​	对于社交网络中每条tweet的热度定义，参考了新闻的热度算法、网页的PageRank算法，以及牛顿冷却定律用以表征retweet操作发生的时间间隔对于热度流动的影响。

​	总体而言，**热度 = 初始热度 + 互动热度 – 随时间衰减的热度**，对应地分为了3个部分：

1. **初始热度**。初始热度与用户的粉丝基础、内容属性相关，影响初始热度的因素有：用户粉丝数、朋友数、推文长度、是否在推文中标记其他用户，及被标记用户的受欢迎程度。该部分记为$S_0$, 经验性地考虑各系数，其公式表示为$S_0 = 0.2 \cdot 粉丝数 + 0.4 \cdot 朋友数 + \sum_i 0.02\cdot被标记用户的粉丝数 $.

2. **互动热度**。互动热度与点赞、转发的用户互动行为有关，将其再分为两方面考虑：静态的点赞、转发数，以及其在社交网络中的联结属性。前者记为$S_1 = 1\cdot 点赞数+ 4\cdot 转发数$；后者则使用了抽税法的PageRank算法，迭代了31次以后收敛，得到代表联通程度的权重向量，将其归一化后再乘以系数100，作为$S_2$. 这里使用到的主要是PageRank中的”数量假设“：在Web图模型中，如果一个页面节点接收到的其他网页指向的入链数量越多，那么这个页面越重要。
3. **随时间衰减**。同样参考PageRank中的另一假设“质量假设”：质量高的页面会通过链接向其他页面传递更多的权重。在以上两部分静态热度的基础上，转发行为的发生致使推文的热度进行流动。新转发的推文产生的热度流向了更早被创建的原始推文。但由于两者间有着时间间隔，其热度的传递有所损耗。时间衰减通常不是线性的，在此参考牛顿冷却公式$T(Time)=e^{(k\cdot (T_1-T_0))}$.如果假设初始热度为100,而设定周期=30天后热度下降至1,则可计算得到冷却系数 $k=-\frac{ln(0.01)}{30 }$，代入公式。对于被转发的原创推文，其热度$S' = S + \frac{S_{retweet}}{T(Time)}$。

其中各经验参数参考一些专利与流行算法，考虑数据集体量后调整而定。

#### 3.2 实现

​	对爬取的3000条推文，首先筛选出有进行转发行为的推文id，作为节点进一步抓取他们所转发的原始推文信息。对所有参与转发行为的3051个节点（由于不是全网数据，有部分原始推文并不在初始爬取得到的数据库中）进行PageRank的计算。迭代31次至误差小于0.00000001后，对最终的3051维向量归一化，固定为PR权重。

​	随后，统一计算静态热度的其余组成部分，形成静态热度，存入数据库。基于静态热度，遍历具有转发行为的节点，将经过时间衰减的额外流入热度加上原有静态热度，为其转发的原创推文创建动态热度属性，存入数据库。

​	在计算过程中所使用到的字段示例：

```
created_at                                Sun May 09 03:41:14 +0000 2021
tweet_id                                             1391236793081683971
user_id												 1032921437387022336
full_text              RT @BritishVogue: .@BillieEilish stars on the ...
text_len															 140
hashtag															#blablab
user_friends                                                         127
user_follower                                                          6
retweet_count                                                       4365
favorite_count                                                         0
user_mentions												 [uid0,uid1]
is_retweet                                                          True

rt_created_at                             Sun May 02 15:59:45 +0000 2021
rt_tweet_id                                          1388885935555743749
rt_user_friends                                                      971
rt_user_follower                                                 3674362
rt_retweet_count                                                    4365
rt_favorite_count                                                  26772
```

### 四、技术方案

+ 分析方法：使用聚类算法，对各种hashtag被发布后的热度变化模式进行统计和聚类。
+ 技术栈：
  + 可视化：matplotlib
  + 数据存储：MongoDB
  + 算法：将每一个hashtag发出后的tweet热度随时间变化的热度作为我们的研究数据，对其<u>进行均值后，通过傅立叶分析得出高维度数据，后通过对高维度数据进行kmeans聚类从而达到我们所需要的聚类效果。</u>

### 五、可视化

